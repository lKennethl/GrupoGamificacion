<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventura Matem√°tica - Mundo de N√∫meros</title>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
    <style>
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --accent-color: #45b7d1;
            --success-color: #00b894;
            --warning-color: #fdcb6e;
            --error-color: #e17055;
            --coin-color: #f39c12;
            --background-gradient: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #00b894 100%);
            --text-light: #ffffff;
            --text-dark: #2d3436;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: var(--background-gradient);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Game Container */
        .game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        /* Header del juego */
        .game-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(45, 52, 54, 0.8));
            backdrop-filter: blur(15px);
            padding: 1rem 2rem;
            z-index: 100;
            border-bottom: 3px solid rgba(78, 205, 196, 0.3);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .game-title {
            color: var(--text-light);
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .game-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            color: var(--text-light);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .coins {
            background: linear-gradient(45deg, var(--coin-color), #e67e22);
            animation: coinGlow 2s infinite;
        }

        .level-indicator {
            background: linear-gradient(45deg, var(--success-color), var(--secondary-color));
        }

        .progress-indicator {
            background: linear-gradient(45deg, var(--accent-color), var(--primary-color));
        }

        /* Personaje 3D */
        .character-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 150px;
            height: 150px;
            z-index: 200;
            animation: characterFloat 3s ease-in-out infinite;
        }

        .character-container model-viewer {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            background: radial-gradient(circle, rgba(78, 205, 196, 0.3), rgba(69, 183, 209, 0.3));
        }

        /* √Årea de juego principal */
        .game-area {
            position: absolute;
            top: 80px;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        /* Tarjeta de pregunta */
        .question-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 248, 255, 0.95));
            border-radius: 30px;
            padding: 3rem;
            max-width: 600px;
            width: 100%;
            text-align: center;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3);
            border: 4px solid rgba(78, 205, 196, 0.4);
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
            animation: cardSlideIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .question-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(78, 205, 196, 0.1) 0%, transparent 70%);
            animation: cardShine 4s infinite;
        }

        .question-number {
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 2rem;
            box-shadow: 0 8px 20px rgba(69, 183, 209, 0.4);
        }

        .question-text {
            font-size: 2.5rem;
            color: var(--text-dark);
            font-weight: bold;
            margin-bottom: 2rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            line-height: 1.2;
        }

        .question-hint {
            font-size: 1.2rem;
            color: #636e72;
            margin-bottom: 2rem;
            font-style: italic;
        }

        /* Opciones de respuesta */
        .answer-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 2rem;
        }

        .answer-btn {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            color: white;
            padding: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .answer-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 35px rgba(78, 205, 196, 0.6);
        }

        .answer-btn.correct {
            background: linear-gradient(135deg, var(--success-color), #55efc4);
            animation: correctAnswer 0.6s ease;
        }

        .answer-btn.incorrect {
            background: linear-gradient(135deg, var(--error-color), #d63031);
            animation: incorrectAnswer 0.6s ease;
        }

        .answer-btn.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Barra de progreso */
        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--secondary-color), var(--accent-color));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 2px 10px rgba(0, 184, 148, 0.4);
        }

        /* Feedback de respuesta */
        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(0, 184, 148, 0.95), rgba(85, 239, 196, 0.95));
            color: white;
            padding: 2rem 3rem;
            border-radius: 25px;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
            z-index: 300;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
            border: 4px solid rgba(255, 255, 255, 0.3);
        }

        .feedback.show {
            opacity: 1;
            visibility: visible;
            animation: feedbackPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .feedback.incorrect {
            background: linear-gradient(135deg, rgba(225, 112, 85, 0.95), rgba(214, 48, 49, 0.95));
        }

        /* Modal de nivel completado */
        .level-complete-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 400;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }

        .level-complete-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 248, 255, 0.95));
            border-radius: 30px;
            padding: 3rem;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 30px 70px rgba(0, 0, 0, 0.4);
            border: 4px solid rgba(78, 205, 196, 0.4);
            animation: modalSlideIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-title {
            font-size: 2.5rem;
            color: var(--text-dark);
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .modal-coins {
            font-size: 3rem;
            color: var(--coin-color);
            margin: 1rem 0;
            animation: coinBounce 1s infinite;
        }

        .modal-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 2rem;
        }

        .modal-btn {
            background: linear-gradient(45deg, var(--secondary-color), var(--accent-color));
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .modal-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(78, 205, 196, 0.6);
        }

        .modal-btn.secondary {
            background: linear-gradient(45deg, var(--warning-color), #e67e22);
        }

        /* Botones de control */
        .game-controls {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 150;
        }

        .control-btn {
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.9), rgba(240, 248, 255, 0.9));
            color: var(--text-dark);
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 3px solid rgba(78, 205, 196, 0.3);
        }

        .control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
        }

        /* Animaciones */
        @keyframes characterFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        @keyframes coinGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(243, 156, 18, 0.5); }
            50% { box-shadow: 0 0 20px rgba(243, 156, 18, 0.8); }
        }

        @keyframes cardSlideIn {
            from { 
                opacity: 0; 
                transform: translateX(100px) scale(0.8); 
            }
                       to { 
                opacity: 1; 
                transform: translateX(0) scale(1); 
            }
        }

        @keyframes cardShine {
            0% { transform: rotate(45deg) translate(-200%, -200%); }
            50% { transform: rotate(45deg) translate(-50%, -50%); }
            100% { transform: rotate(45deg) translate(200%, 200%); }
        }

        @keyframes correctAnswer {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectAnswer {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
            100% { transform: translateX(0); }
        }

        @keyframes feedbackPop {
            0% { transform: translate(-50%, -50%) scale(0.5); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes modalSlideIn {
            from { 
                opacity: 0; 
                transform: translateY(-50px) scale(0.8); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        @keyframes coinBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-header {
                padding: 0.8rem 1rem;
            }

            .game-title {
                font-size: 1.4rem;
            }

            .game-stats {
                gap: 10px;
            }

            .stat-item {
                padding: 6px 12px;
                font-size: 0.9rem;
            }

            .character-container {
                width: 120px;
                height: 120px;
                bottom: 15px;
                left: 15px;
            }

            .question-card {
                padding: 2rem;
                margin: 1rem;
            }

            .question-text {
                font-size: 2rem;
            }

            .answer-options {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .answer-btn {
                padding: 15px;
                font-size: 1.3rem;
            }

            .game-controls {
                right: 15px;
                gap: 10px;
            }

            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .modal-content {
                padding: 2rem;
                margin: 1rem;
            }

            .modal-title {
                font-size: 2rem;
            }

            .modal-buttons {
                flex-direction: column;
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .question-text {
                font-size: 1.8rem;
            }

            .answer-btn {
                font-size: 1.2rem;
            }

            .modal-coins {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header del juego -->
    <div class="game-header">
        <div class="header-content">
            <h1 class="game-title">üî¢ Aventura Matem√°tica</h1>
            <div class="game-stats">
                <div class="stat-item coins">
                    <span>ü™ô</span>
                    <span id="coinCount">0</span>
                </div>
                <div class="stat-item level-indicator">
                    <span>üìä</span>
                    <span id="currentLevel">Nivel 1</span>
                </div>
                <div class="stat-item progress-indicator">
                    <span>üìà</span>
                    <span id="questionProgress">1/20</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenedor del juego -->
    <div class="game-container">
        <!-- Personaje 3D -->
        <div class="character-container">
            <model-viewer 
                id="gameCharacter"
                src=""
                alt="Personaje del juego"
                camera-controls
                auto-rotate
                rotation-per-second="20deg"
                shadow-intensity="1"
                environment-image="neutral"
                exposure="1"
                loading="eager"
                autoplay
            ></model-viewer>
        </div>

        <!-- √Årea principal del juego -->
        <div class="game-area">
            <div class="question-card" id="questionCard">
                <div class="question-number" id="questionNumber">Pregunta 1</div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 5%"></div>
                </div>

                <div class="question-text" id="questionText">¬øCu√°nto es 2 + 3?</div>
                
                <div class="question-hint" id="questionHint">¬°Piensa bien antes de responder!</div>

                <div class="answer-options" id="answerOptions">
                    <button class="answer-btn" onclick="selectAnswer(0)">4</button>
                    <button class="answer-btn" onclick="selectAnswer(1)">5</button>
                    <button class="answer-btn" onclick="selectAnswer(2)">6</button>
                    <button class="answer-btn" onclick="selectAnswer(3)">7</button>
                </div>
            </div>
        </div>

        <!-- Controles del juego -->
        <div class="game-controls">
            <button class="control-btn" onclick="pauseGame()" title="Pausar">‚è∏Ô∏è</button>
            <button class="control-btn" onclick="showHint()" title="Pista">üí°</button>
            <button class="control-btn" onclick="goBack()" title="Salir">üè†</button>
        </div>
    </div>

    <!-- Feedback de respuesta -->
    <div class="feedback" id="feedback">
        <div id="feedbackText">¬°Correcto!</div>
        <div id="feedbackCoins">+2 ü™ô</div>
    </div>

    <!-- Modal de nivel completado -->
    <div class="level-complete-modal" id="levelCompleteModal">
        <div class="modal-content">
            <h2 class="modal-title">üéâ ¬°Nivel Completado!</h2>
            <div class="modal-coins" id="modalCoins">+10 ü™ô</div>
            <p id="modalMessage">¬°Excelente trabajo! Has ganado 10 monedas.</p>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="nextLevel()">Siguiente Nivel</button>
                <button class="modal-btn secondary" onclick="goToMenu()">Men√∫ Principal</button>
            </div>
        </div>
    </div>

    <script>
        // Variables del juego
        let currentLevel = 1;
        let currentQuestion = 0;
        let totalQuestions = 20;
        let score = 0;
        let coins = 0;
        let correctAnswers = 0;
        let gameData = {
            level1: { reward: 10, difficulty: 1 },
            level2: { reward: 20, difficulty: 1.2 },
            level3: { reward: 30, difficulty: 1.4 }
        };

        // Preguntas por nivel
        const questions = {
            level1: [
                { question: "¬øCu√°nto es 2 + 3?", options: ["4", "5", "6", "7"], correct: 1, hint: "Cuenta con tus dedos: 2... 3, 4, 5" },
                { question: "¬øCu√°nto es 8 - 4?", options: ["3", "4", "5", "6"], correct: 1, hint: "Si tienes 8 caramelos y comes 4, ¬øcu√°ntos quedan?" },
                { question: "¬øCu√°nto es 3 √ó 2?", options: ["5", "6", "7", "8"], correct: 1, hint: "3 grupos de 2 elementos cada uno" },
                { question: "¬øCu√°nto es 10 √∑ 2?", options: ["4", "5", "6", "7"], correct: 1, hint: "Divide 10 en 2 partes iguales" },
                { question: "¬øCu√°nto es 1 + 1?", options: ["1", "2", "3", "4"], correct: 1, hint: "¬°La m√°s f√°cil de todas!" },
                { question: "¬øCu√°nto es 5 + 2?", options: ["6", "7", "8", "9"], correct: 1, hint: "Empieza desde 5 y cuenta 2 m√°s" },
                { question: "¬øCu√°nto es 9 - 3?", options: ["5", "6", "7", "8"], correct: 1, hint: "De 9, quita 3" },
                { question: "¬øCu√°nto es 4 √ó 1?", options: ["3", "4", "5", "6"], correct: 1, hint: "Cualquier n√∫mero multiplicado por 1..." },
                { question: "¬øCu√°nto es 6 √∑ 3?", options: ["1", "2", "3", "4"], correct: 1, hint: "¬øCu√°ntas veces cabe el 3 en el 6?" },
                { question: "¬øCu√°nto es 7 + 1?", options: ["7", "8", "9", "10"], correct: 1, hint: "Solo suma uno m√°s a 7" },
                { question: "¬øCu√°nto es 10 - 5?", options: ["4", "5", "6", "7"], correct: 1, hint: "La mitad de 10" },
                { question: "¬øCu√°nto es 2 √ó 3?", options: ["5", "6", "7", "8"], correct: 1, hint: "2 + 2 + 2 = ?" },
                { question: "¬øCu√°nto es 8 √∑ 4?", options: ["1", "2", "3", "4"], correct: 1, hint: "Divide 8 en 4 partes iguales" },
                { question: "¬øCu√°nto es 4 + 4?", options: ["7", "8", "9", "10"], correct: 1, hint: "El doble de 4" },
                { question: "¬øCu√°nto es 6 - 2?", options: ["3", "4", "5", "6"], correct: 1, hint: "De 6, resta 2" },
                { question: "¬øCu√°nto es 3 √ó 3?", options: ["8", "9", "10", "11"], correct: 1, hint: "3 + 3 + 3 = ?" },
                { question: "¬øCu√°nto es 12 √∑ 4?", options: ["2", "3", "4", "5"], correct: 1, hint: "¬øCu√°ntas veces cabe el 4 en el 12?" },
                { question: "¬øCu√°nto es 5 + 5?", options: ["9", "10", "11", "12"], correct: 1, hint: "El doble de 5" },
                { question: "¬øCu√°nto es 7 - 3?", options: ["3", "4", "5", "6"], correct: 1, hint: "Cuenta hacia atr√°s desde 7" },
                { question: "¬øCu√°nto es 2 √ó 4?", options: ["6", "7", "8", "9"], correct: 2, hint: "2 grupos de 4 elementos" }
            ],
            level2: [
                { question: "¬øCu√°nto es 15 + 8?", options: ["22", "23", "24", "25"], correct: 1, hint: "15 + 8, suma las unidades primero" },
                { question: "¬øCu√°nto es 25 - 9?", options: ["15", "16", "17", "18"], correct: 1, hint: "Resta 10 y suma 1" },
                { question: "¬øCu√°nto es 6 √ó 4?", options: ["22", "23", "24", "25"], correct: 2, hint: "6 + 6 + 6 + 6 = ?" },
                { question: "¬øCu√°nto es 18 √∑ 3?", options: ["5", "6", "7", "8"], correct: 1, hint: "¬øCu√°ntas veces cabe el 3 en el 18?" },
                { question: "¬øCu√°nto es 12 + 15?", options: ["26", "27", "28", "29"], correct: 1, hint: "12 + 15, suma decenas y unidades" },
                { question: "¬øCu√°nto es 30 - 12?", options: ["17", "18", "19", "20"], correct: 1, hint: "30 - 12, resta paso a paso" },
                { question: "¬øCu√°nto es 7 √ó 3?", options: ["20", "21", "22", "23"], correct: 1, hint: "7 + 7 + 7 = ?" },
                { question: "¬øCu√°nto es 24 √∑ 6?", options: ["3", "4", "5", "6"], correct: 1, hint: "Divide 24 en 6 partes iguales" },
                { question: "¬øCu√°nto es 14 + 17?", options: ["30", "31", "32", "33"], correct: 1, hint: "14 + 17, suma cuidadosamente" },
                { question: "¬øCu√°nto es 28 - 15?", options: ["12", "13", "14", "15"], correct: 1, hint: "28 - 15, cuenta hacia atr√°s" },
                { question: "¬øCu√°nto es 8 √ó 5?", options: ["38", "39", "40", "41"], correct: 2, hint: "8 √ó 5 = 8 + 8 + 8 + 8 + 8" },
                { question: "¬øCu√°nto es 35 √∑ 7?", options: ["4", "5", "6", "7"], correct: 1, hint: "¬øCu√°ntas veces cabe el 7 en el 35?" },
                { question: "¬øCu√°nto es 19 + 16?", options: ["34", "35", "36", "37"], correct: 1, hint: "19 + 16, suma las unidades primero" },
                { question: "¬øCu√°nto es 32 - 18?", options: ["13", "14", "15", "16"], correct: 1, hint: "32 - 18, resta con cuidado" },
                                { question: "¬øCu√°nto es 9 √ó 4?", options: ["34", "35", "36", "37"], correct: 2, hint: "9 √ó 4 = 9 + 9 + 9 + 9" },
                { question: "¬øCu√°nto es 42 √∑ 6?", options: ["6", "7", "8", "9"], correct: 1, hint: "Divide 42 en 6 partes iguales" },
                { question: "¬øCu√°nto es 23 + 19?", options: ["41", "42", "43", "44"], correct: 1, hint: "23 + 19, suma decenas y unidades" },
                { question: "¬øCu√°nto es 45 - 27?", options: ["17", "18", "19", "20"], correct: 1, hint: "45 - 27, resta paso a paso" },
                { question: "¬øCu√°nto es 6 √ó 7?", options: ["40", "41", "42", "43"], correct: 2, hint: "6 √ó 7 = 6 + 6 + 6 + 6 + 6 + 6 + 6" },
                { question: "¬øCu√°nto es 48 √∑ 8?", options: ["5", "6", "7", "8"], correct: 1, hint: "¬øCu√°ntas veces cabe el 8 en el 48?" }
            ],
            level3: [
                { question: "¬øCu√°nto es 47 + 38?", options: ["83", "84", "85", "86"], correct: 2, hint: "47 + 38, suma con reagrupaci√≥n" },
                { question: "¬øCu√°nto es 73 - 29?", options: ["43", "44", "45", "46"], correct: 1, hint: "73 - 29, resta con reagrupaci√≥n" },
                { question: "¬øCu√°nto es 12 √ó 6?", options: ["70", "71", "72", "73"], correct: 2, hint: "12 √ó 6 = (10 √ó 6) + (2 √ó 6)" },
                { question: "¬øCu√°nto es 84 √∑ 12?", options: ["6", "7", "8", "9"], correct: 1, hint: "¬øCu√°ntas veces cabe el 12 en el 84?" },
                { question: "¬øCu√°nto es 56 + 47?", options: ["101", "102", "103", "104"], correct: 2, hint: "56 + 47, suma con cuidado" },
                { question: "¬øCu√°nto es 91 - 48?", options: ["42", "43", "44", "45"], correct: 1, hint: "91 - 48, resta con reagrupaci√≥n" },
                { question: "¬øCu√°nto es 15 √ó 4?", options: ["58", "59", "60", "61"], correct: 2, hint: "15 √ó 4 = (10 √ó 4) + (5 √ó 4)" },
                { question: "¬øCu√°nto es 96 √∑ 8?", options: ["11", "12", "13", "14"], correct: 1, hint: "Divide 96 en 8 partes iguales" },
                { question: "¬øCu√°nto es 68 + 55?", options: ["121", "122", "123", "124"], correct: 2, hint: "68 + 55, suma las centenas tambi√©n" },
                { question: "¬øCu√°nto es 82 - 37?", options: ["44", "45", "46", "47"], correct: 1, hint: "82 - 37, resta paso a paso" },
                { question: "¬øCu√°nto es 13 √ó 7?", options: ["89", "90", "91", "92"], correct: 2, hint: "13 √ó 7 = (10 √ó 7) + (3 √ó 7)" },
                { question: "¬øCu√°nto es 108 √∑ 9?", options: ["11", "12", "13", "14"], correct: 1, hint: "¬øCu√°ntas veces cabe el 9 en el 108?" },
                { question: "¬øCu√°nto es 79 + 66?", options: ["143", "144", "145", "146"], correct: 2, hint: "79 + 66, suma con reagrupaci√≥n" },
                { question: "¬øCu√°nto es 95 - 58?", options: ["36", "37", "38", "39"], correct: 1, hint: "95 - 58, resta con cuidado" },
                { question: "¬øCu√°nto es 16 √ó 5?", options: ["78", "79", "80", "81"], correct: 2, hint: "16 √ó 5 = 16 + 16 + 16 + 16 + 16" },
                { question: "¬øCu√°nto es 132 √∑ 11?", options: ["11", "12", "13", "14"], correct: 1, hint: "Divide 132 en 11 partes iguales" },
                { question: "¬øCu√°nto es 87 + 78?", options: ["163", "164", "165", "166"], correct: 2, hint: "87 + 78, suma con reagrupaci√≥n" },
                { question: "¬øCu√°nto es 104 - 67?", options: ["36", "37", "38", "39"], correct: 1, hint: "104 - 67, resta paso a paso" },
                { question: "¬øCu√°nto es 14 √ó 8?", options: ["110", "111", "112", "113"], correct: 2, hint: "14 √ó 8 = (10 √ó 8) + (4 √ó 8)" },
                { question: "¬øCu√°nto es 144 √∑ 12?", options: ["11", "12", "13", "14"], correct: 1, hint: "¬øCu√°ntas veces cabe el 12 en el 144?" }
            ]
        };

        // Inicializar juego
        function initGame() {
            console.log('üéÆ Iniciando Aventura Matem√°tica');
            
            // Cargar personaje seleccionado
            loadSelectedCharacter();
            
            // Cargar monedas guardadas
            loadCoins();
            
            // Cargar progreso del nivel
            loadGameProgress();
            
            // Mostrar primera pregunta
            showQuestion();
            
            console.log('‚úÖ Juego inicializado correctamente');
        }

        // Cargar personaje seleccionado
        function loadSelectedCharacter() {
            try {
                const selectedCharacter = localStorage.getItem('selectedCharacter');
                if (selectedCharacter) {
                    const character = JSON.parse(selectedCharacter);
                    const characterModel = document.getElementById('gameCharacter');
                    characterModel.src = character.model;
                    characterModel.alt = character.name;
                    console.log('üë§ Personaje cargado:', character.name);
                } else {
                    console.log('‚ö†Ô∏è No hay personaje seleccionado, usando modelo por defecto');
                    document.getElementById('gameCharacter').src = 'images/3D/balerina_capuchina/scene.gltf';
                }
            } catch (error) {
                console.error('‚ùå Error al cargar personaje:', error);
            }
        }

        // Cargar monedas guardadas
        function loadCoins() {
            const savedCoins = localStorage.getItem('totalCoins') || '0';
            coins = parseInt(savedCoins);
            updateCoinDisplay();
        }

        // Cargar progreso del juego
        function loadGameProgress() {
            const savedLevel = localStorage.getItem('mathGameLevel') || '1';
            const savedQuestion = localStorage.getItem('mathGameQuestion') || '0';
            
            currentLevel = parseInt(savedLevel);
            currentQuestion = parseInt(savedQuestion);
            
            updateLevelDisplay();
            updateProgressDisplay();
        }

        // Mostrar pregunta actual
        function showQuestion() {
            const levelQuestions = questions[`level${currentLevel}`];
            const question = levelQuestions[currentQuestion];
            
            // Actualizar elementos de la UI
            document.getElementById('questionNumber').textContent = `Pregunta ${currentQuestion + 1}`;
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionHint').textContent = question.hint;
            
            // Actualizar opciones de respuesta
            const answerButtons = document.querySelectorAll('.answer-btn');
            answerButtons.forEach((btn, index) => {
                btn.textContent = question.options[index];
                btn.className = 'answer-btn';
                btn.disabled = false;
            });
            
            // Actualizar progreso
            updateProgressDisplay();
            
            // Animaci√≥n de entrada de la tarjeta
            const questionCard = document.getElementById('questionCard');
            questionCard.style.animation = 'none';
            setTimeout(() => {
                questionCard.style.animation = 'cardSlideIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            }, 50);
        }

        // Seleccionar respuesta
        function selectAnswer(selectedIndex) {
            const levelQuestions = questions[`level${currentLevel}`];
            const question = levelQuestions[currentQuestion];
            const answerButtons = document.querySelectorAll('.answer-btn');
            
            // Deshabilitar todos los botones
            answerButtons.forEach(btn => {
                btn.classList.add('disabled');
                btn.disabled = true;
            });
            
            // Marcar respuesta correcta e incorrecta
            answerButtons[question.correct].classList.add('correct');
            
            if (selectedIndex === question.correct) {
                // Respuesta correcta
                correctAnswers++;
                const coinsEarned = Math.floor(gameData[`level${currentLevel}`].reward / 10);
                coins += coinsEarned;
                
                showFeedback(true, coinsEarned);
                
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                }
            } else {
                // Respuesta incorrecta
                answerButtons[selectedIndex].classList.add('incorrect');
                showFeedback(false, 0);
                
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
            }
            
            // Guardar progreso
            saveGameProgress();
            
            // Continuar al siguiente paso despu√©s de 2 segundos
            setTimeout(() => {
                nextQuestion();
            }, 2000);
        }

        // Mostrar feedback
        function showFeedback(isCorrect, coinsEarned) {
            const feedback = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedbackText');
            const feedbackCoins = document.getElementById('feedbackCoins');
            
            if (isCorrect) {
                feedbackText.textContent = '¬°Correcto! üéâ';
                feedbackCoins.textContent = `+${coinsEarned} ü™ô`;
                feedback.className = 'feedback show';
            } else {
                feedbackText.textContent = '¬°Int√©ntalo de nuevo! üí™';
                feedbackCoins.textContent = 'Sin monedas esta vez';
                feedback.className = 'feedback show incorrect';
            }
            
            updateCoinDisplay();
            
            setTimeout(() => {
                feedback.classList.remove('show');
            }, 1500);
        }

        // Siguiente pregunta
        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion >= totalQuestions) {
                // Nivel completado
                completeLevel();
            } else {
                // Mostrar siguiente pregunta
                showQuestion();
            }
        }

        // Completar nivel
        function completeLevel() {
            const levelReward = gameData[`level${currentLevel}`].reward;
            coins += levelReward;
            
            // Mostrar modal de nivel completado
            const modal = document.getElementById('levelCompleteModal');
            const modalCoins = document.getElementById('modalCoins');
            const modalMessage = document.getElementById('modalMessage');
            
            modalCoins.textContent = `+${levelReward} ü™ô`;
            modalMessage.textContent = `¬°Incre√≠ble! Respondiste ${correctAnswers} de ${totalQuestions} preguntas correctamente y ganaste ${levelReward} monedas.`;
            
            modal.classList.add('show');
            
            // Guardar progreso
            saveGameProgress();
            updateCoinDisplay();
            
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
        }

        // Siguiente nivel
        function nextLevel() {
            if (currentLevel < 3) {
                currentLevel++;
                currentQuestion = 0;
                correctAnswers = 0;
                
                document.getElementById('levelCompleteModal').classList.remove('show');
                
                updateLevelDisplay();
                showQuestion();
                
                // Mensaje de nuevo nivel
                setTimeout(() => {
                    alert(`üéä ¬°Bienvenido al Nivel ${currentLevel}! üéä\n\nLa dificultad ha aumentado, pero las recompensas tambi√©n. ¬°Buena suerte!`);
                }, 500);
            } else {
                // Juego completado
                gameCompleted();
            }
        }

        // Juego completado
        function gameCompleted() {
            document.getElementById('levelCompleteModal').classList.remove('show');
            
            alert(`üèÜ ¬°FELICITACIONES! üèÜ\n\n¬°Has completado todos los niveles de Aventura Matem√°tica!\n\nMonedas totales ganadas: ${coins} ü™ô\n\n¬°Eres un verdadero genio de las matem√°ticas!`);
            
            // Resetear progreso para poder jugar de nuevo
            localStorage.removeItem('mathGameLevel');
            localStorage.removeItem('mathGameQuestion');
            
            goToMenu();
        }

        // Ir al men√∫ principal
        function goToMenu() {
            window.location.href = 'play.html';
        }

        // Actualizar displays
        function updateCoinDisplay() {
            document.getElementById('coinCount').textContent = coins;
            localStorage.setItem('totalCoins', coins.toString());
        }

        function updateLevelDisplay() {
            document.getElementById('currentLevel').textContent = `Nivel ${currentLevel}`;
        }

        function updateProgressDisplay() {
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('questionProgress').textContent = `${currentQuestion + 1}/${totalQuestions}`;
        }

        // Guardar progreso del juego
        function saveGameProgress() {
            localStorage.setItem('mathGameLevel', currentLevel.toString());
            localStorage.setItem('mathGameQuestion', currentQuestion.toString());
            localStorage.setItem('totalCoins', coins.toString());
        }

        // Funciones de control
        function pauseGame() {
            const confirmPause = confirm('‚è∏Ô∏è ¬øQuieres pausar el juego?\n\nTu progreso se guardar√° autom√°ticamente.');
            if (confirmPause) {
                saveGameProgress();
                alert('üíæ Juego pausado y guardado.\n\n¬°Puedes continuar cuando quieras!');                goToMenu();
            }
        }

        function showHint() {
            const levelQuestions = questions[`level${currentLevel}`];
            const question = levelQuestions[currentQuestion];
            
            alert(`üí° Pista:\n\n${question.hint}\n\n¬°Ahora int√©ntalo!`);
            
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
        }

        function goBack() {
            const confirmExit = confirm('üè† ¬øEst√°s seguro de que quieres salir?\n\nTu progreso se guardar√° autom√°ticamente.');
            if (confirmExit) {
                saveGameProgress();
                window.location.href = 'play.html';
            }
        }

        // Controles de teclado
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case '1':
                    selectAnswer(0);
                    break;
                case '2':
                    selectAnswer(1);
                    break;
                case '3':
                    selectAnswer(2);
                    break;
                case '4':
                    selectAnswer(3);
                    break;
                case 'h':
                case 'H':
                    showHint();
                    break;
                case 'p':
                case 'P':
                    pauseGame();
                    break;
                case 'Escape':
                    goBack();
                    break;
            }
        });

        // Controles t√°ctiles mejorados
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            
            // Detectar gestos de deslizamiento
            if (Math.abs(deltaX) > 50 || Math.abs(deltaY) > 50) {
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // Deslizamiento horizontal
                    if (deltaX > 0) {
                        // Deslizar a la derecha - mostrar pista
                        showHint();
                    } else {
                        // Deslizar a la izquierda - pausar
                        pauseGame();
                    }
                } else {
                    // Deslizamiento vertical
                    if (deltaY > 0) {
                        // Deslizar hacia abajo - salir
                        goBack();
                    }
                }
            }
        });

        // Efectos de sonido simulados con vibraci√≥n
        function playHapticFeedback(type) {
            if (!navigator.vibrate) return;
            
            switch(type) {
                case 'correct':
                    navigator.vibrate([100, 50, 100, 50, 100]);
                    break;
                case 'incorrect':
                    navigator.vibrate([200, 100, 200]);
                    break;
                case 'levelComplete':
                    navigator.vibrate([300, 100, 300, 100, 300]);
                    break;
                case 'click':
                    navigator.vibrate(50);
                    break;
            }
        }

        // A√±adir efectos haptic a los botones
        document.querySelectorAll('.answer-btn').forEach(btn => {
            btn.addEventListener('click', () => playHapticFeedback('click'));
        });

        document.querySelectorAll('.control-btn').forEach(btn => {
            btn.addEventListener('click', () => playHapticFeedback('click'));
        });

        // Funci√≥n para mezclar preguntas (opcional)
        function shuffleQuestions() {
            Object.keys(questions).forEach(level => {
                for (let i = questions[level].length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [questions[level][i], questions[level][j]] = [questions[level][j], questions[level][i]];
                }
            });
            console.log('üîÄ Preguntas mezcladas para mayor variedad');
        }

        // Funci√≥n para obtener estad√≠sticas del jugador
        function getPlayerStats() {
            const stats = {
                totalCoins: coins,
                currentLevel: currentLevel,
                currentQuestion: currentQuestion,
                correctAnswers: correctAnswers,
                accuracy: correctAnswers > 0 ? Math.round((correctAnswers / (currentQuestion + 1)) * 100) : 0
            };
            
            console.log('üìä Estad√≠sticas del jugador:', stats);
            return stats;
        }

        // Funci√≥n para mostrar estad√≠sticas
        function showStats() {
            const stats = getPlayerStats();
            const message = `üìä TUS ESTAD√çSTICAS üìä\n\n` +
                          `ü™ô Monedas totales: ${stats.totalCoins}\n` +
                          `üìà Nivel actual: ${stats.currentLevel}\n` +
                          `‚ùì Pregunta actual: ${stats.currentQuestion + 1}/${totalQuestions}\n` +
                          `‚úÖ Respuestas correctas: ${stats.correctAnswers}\n` +
                          `üéØ Precisi√≥n: ${stats.accuracy}%`;
            
            alert(message);
        }

        // Funci√≥n para resetear progreso (para desarrollo/testing)
        function resetProgress() {
            const confirmReset = confirm('‚ö†Ô∏è ¬øEst√°s seguro de que quieres resetear todo tu progreso?\n\nEsta acci√≥n no se puede deshacer.');
            if (confirmReset) {
                localStorage.removeItem('mathGameLevel');
                localStorage.removeItem('mathGameQuestion');
                localStorage.removeItem('totalCoins');
                
                currentLevel = 1;
                currentQuestion = 0;
                coins = 0;
                correctAnswers = 0;
                
                updateCoinDisplay();
                updateLevelDisplay();
                showQuestion();
                
                alert('üîÑ Progreso reseteado. ¬°Empezando desde el principio!');
            }
        }

        // Funci√≥n para detectar si es la primera vez jugando
        function isFirstTimePlayer() {
            return !localStorage.getItem('mathGameLevel') && !localStorage.getItem('totalCoins');
        }

        // Tutorial para nuevos jugadores
        function showTutorial() {
            if (isFirstTimePlayer()) {
                setTimeout(() => {
                    alert(`üéÆ ¬°BIENVENIDO A AVENTURA MATEM√ÅTICA! üéÆ\n\n` +
                          `üéØ C√ìMO JUGAR:\n` +
                          `‚Ä¢ Responde 20 preguntas por nivel\n` +
                          `‚Ä¢ Gana monedas por respuestas correctas\n` +
                          `‚Ä¢ Usa las teclas 1-4 o toca las opciones\n` +
                          `‚Ä¢ Desliza ‚Üí para pistas, ‚Üê para pausar\n\n` +
                          `üí∞ RECOMPENSAS:\n` +
                          `‚Ä¢ Nivel 1: 10 monedas\n` +
                          `‚Ä¢ Nivel 2: 20 monedas\n` +
                          `‚Ä¢ Nivel 3: 30 monedas\n\n` +
                          `¬°Buena suerte! üçÄ`);
                }, 1000);
            }
        }

        // Funci√≥n para manejar errores
        window.addEventListener('error', (e) => {
            console.error('‚ùå Error en el juego:', e.error);
            
            // Intentar recuperaci√≥n autom√°tica
            setTimeout(() => {
                try {
                    loadSelectedCharacter();
                    updateCoinDisplay();
                    updateLevelDisplay();
                    console.log('üîß Recuperaci√≥n autom√°tica exitosa');
                } catch (recoveryError) {
                    console.error('‚ùå Error en recuperaci√≥n:', recoveryError);
                    alert('‚ö†Ô∏è Ocurri√≥ un error. Por favor, recarga la p√°gina.');
                }
            }, 1000);
        });

        // Funci√≥n para optimizar rendimiento en m√≥viles
        function optimizeForMobile() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                console.log('üì± Dispositivo m√≥vil detectado - Aplicando optimizaciones');
                
                // Reducir animaciones para mejor rendimiento
                document.documentElement.style.setProperty('--animation-duration', '0.3s');
                
                // Optimizar model-viewer para m√≥viles
                const characterModel = document.getElementById('gameCharacter');
                characterModel.setAttribute('rotation-per-second', '10deg');
                characterModel.setAttribute('interaction-prompt-style', 'none');
            }
        }

        // Funci√≥n para manejar cambios de orientaci√≥n
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                updateProgressDisplay();
                console.log('üîÑ Orientaci√≥n cambiada - UI actualizada');
            }, 100);
        });

        // Funci√≥n para prevenir zoom accidental en m√≥viles
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Funci√≥n para guardar estad√≠sticas detalladas
        function saveDetailedStats() {
            const detailedStats = {
                totalGamesPlayed: parseInt(localStorage.getItem('totalGamesPlayed') || '0') + 1,
                totalQuestionsAnswered: parseInt(localStorage.getItem('totalQuestionsAnswered') || '0') + currentQuestion + 1,
                totalCorrectAnswers: parseInt(localStorage.getItem('totalCorrectAnswers') || '0') + correctAnswers,
                highestLevel: Math.max(parseInt(localStorage.getItem('highestLevel') || '1'), currentLevel),
                lastPlayDate: new Date().toISOString()
            };
            
            Object.keys(detailedStats).forEach(key => {
                localStorage.setItem(key, detailedStats[key].toString());
            });
            
            console.log('üìà Estad√≠sticas detalladas guardadas:', detailedStats);
        }

        // Inicializar juego al cargar la p√°gina
        window.addEventListener('load', function() {
            console.log('üéÆ Cargando Aventura Matem√°tica...');
            
            // Optimizaciones
            optimizeForMobile();
            
            // Mezclar preguntas para variedad
            shuffleQuestions();
            
            // Inicializar juego
            initGame();
            
            // Mostrar tutorial si es primera vez
            showTutorial();
            
            console.log('‚úÖ Aventura Matem√°tica completamente cargada');
            console.log('üéØ Caracter√≠sticas activas:');
            console.log('  - 3 niveles de dificultad ‚úÖ');
            console.log('  - 60 preguntas √∫nicas ‚úÖ');
            console.log('  - Sistema de monedas ‚úÖ');
            console.log('  - Personaje 3D integrado ‚úÖ');
            console.log('  - Controles t√°ctiles y teclado ‚úÖ');
            console.log('  - Guardado autom√°tico ‚úÖ');
            console.log('  - Efectos h√°pticos ‚úÖ');
            console.log('  - Optimizaciones m√≥viles ‚úÖ');
        });

        // Guardar estad√≠sticas al salir
        window.addEventListener('beforeunload', () => {
            saveGameProgress();
            saveDetailedStats();
        });

        // Funci√≥n de depuraci√≥n (solo para desarrollo)
        function debugGame() {
            console.log('üêõ INFORMACI√ìN DE DEPURACI√ìN:');
            console.log('Nivel actual:', currentLevel);
            console.log('Pregunta actual:', currentQuestion);
            console.log('Monedas:', coins);
            console.log('Respuestas correctas:', correctAnswers);
            console.log('Personaje cargado:', document.getElementById('gameCharacter').src);
            console.log('LocalStorage:', {
                mathGameLevel: localStorage.getItem('mathGameLevel'),
                mathGameQuestion: localStorage.getItem('mathGameQuestion'),
                totalCoins: localStorage.getItem('totalCoins'),
                selectedCharacter: localStorage.getItem('selectedCharacter')
            });
        }

        // Hacer funciones disponibles globalmente para depuraci√≥n
        window.debugGame = debugGame;
        window.showStats = showStats;
        window.resetProgress = resetProgress;

        console.log('üéÆ Aventura Matem√°tica - Sistema completo inicializado');
    </script>
</body>
</html>
                